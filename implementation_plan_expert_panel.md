# æ··åˆé…ç½®ç³»ç»Ÿä¸"ä¸“å®¶ä¼šè¯Š"æ¨¡å¼å®æ–½è®¡åˆ’

## ğŸ¯ ç›®æ ‡
1.  **æ··åˆé…ç½®ç³»ç»Ÿ (Hybrid Config)**: æ”¯æŒä» `.env` æ–‡ä»¶æˆ–æ•°æ®åº“åŠ è½½/ä¿å­˜é…ç½®ã€‚éƒ¨ç½²è‡³æœåŠ¡å™¨æ—¶å¯ä¼˜å…ˆä½¿ç”¨æ•°æ®åº“ï¼ŒGitHub Actions ç­‰ CI ç¯å¢ƒä¼˜å…ˆä½¿ç”¨ç¯å¢ƒå˜é‡ã€‚
2.  **ä¸“å®¶ä¼šè¯Šæ¨¡å¼ (Expert Panel)**: åœ¨æ··åˆé…ç½®çš„åŸºç¡€ä¸Šï¼Œå®ç°å¤šæ¨¡å‹å¹¶è¡Œåˆ†æåŠå¯¹æ¯”å±•ç¤ºã€‚

## âš ï¸ éœ€ç”¨æˆ·ç¡®è®¤
> [!IMPORTANT]
> **æ•°æ®åº“å˜æ›´**:
> 1. æ–°å¢ `system_config` è¡¨ï¼Œç”¨äºå­˜å‚¨ç³»ç»Ÿè®¾ç½®ã€‚
> 2. åœ¨ `analysis_history` è¡¨ä¸­æ–°å¢ `model_details` åˆ—ï¼Œç”¨äºå­˜å‚¨å¤šæ¨¡å‹åˆ†ææŠ¥å‘Šã€‚
> **é…ç½®ä¼˜å…ˆçº§**:
> å¼•å…¥ `CONFIG_STORAGE_TYPE` (å–å€¼: `env` æˆ– `db`)ã€‚é»˜è®¤ä¸º `env`ã€‚

---

## ğŸ› ï¸ è¯¦ç»†å˜æ›´è®¡åˆ’

### ç¬¬ä¸€é˜¶æ®µï¼šæ··åˆé…ç½®å±‚ (Hybrid Configuration Layer)

#### 1. æ•°æ®åº“å±‚ (`src/storage.py`)
- [NEW] æ–°å¢ `SystemConfig` æ¨¡å‹ï¼š
  ```python
  class SystemConfig(Base):
      __tablename__ = 'system_config'
      key = Column(String(100), primary_key=True)
      value = Column(Text)
      updated_at = Column(DateTime, default=datetime.now, onupdate=datetime.now)
  ```
- ä¸º `DatabaseManager` æ·»åŠ  `get_config(key)`, `set_config(key, value)`, `get_all_configs()` æ–¹æ³•ã€‚

#### 2. é…ç½®ç®¡ç†é€»è¾‘ (`src/core/config_manager.py`)
- é‡æ„ `ConfigManager`ï¼Œä½¿å…¶æ”¯æŒå¯æ’æ‹”åç«¯ï¼š
  - `EnvBackend`: è¯»å†™ `.env` æ–‡ä»¶ï¼ˆä¿æŒç°æœ‰é€»è¾‘ï¼‰ã€‚
  - `DbBackend`: è¯»å†™æ•°æ®åº“ `system_config` è¡¨ã€‚
- æ ¹æ®ç¯å¢ƒå˜é‡ `CONFIG_STORAGE_TYPE` åŠ¨æ€é€‰æ‹©åç«¯ã€‚

---

### ç¬¬äºŒé˜¶æ®µï¼šä¸“å®¶ä¼šè¯ŠåŠŸèƒ½ (Expert Panel Feature)

#### 1. å¤šæ¨¡å‹è°ƒåº¦ (`src/analyzer.py`)
- **æå–æ¥å£**: å®šä¹‰ `BaseAnalyzer` å®šä¹‰ `analyze()` æ¥å£ã€‚
- **æ‰©å±•å®ç°**:
  - `GeminiAnalyzer`: é€‚é…ç°æœ‰é€»è¾‘ã€‚
  - `OpenAICompatibleAnalyzer`: æ–°å¢ï¼Œæ”¯æŒ DeepSeek, Claude, GPT-4 ç­‰æ‰€æœ‰å…¼å®¹ OpenAI æ ¼å¼çš„æ¨¡å‹ã€‚
- **å¹¶å‘è°ƒåº¦**: å®ç° `ExpertPanelManager`ï¼Œä½¿ç”¨ `ThreadPoolExecutor` æˆ–å¼‚æ­¥æ–¹å¼åŒæ—¶è°ƒç”¨é€‰ä¸­çš„æ¨¡å‹ï¼ˆæœ€å¤š 5 ä¸ªï¼‰ã€‚

#### 2. ç³»ç»Ÿæµæ°´çº¿ (`src/core/pipeline.py`)
- ä¿®æ”¹ `StockAnalysisPipeline`:
  - æ¥å…¥ `ExpertPanelManager`ã€‚
  - **æ±‡æ€»ç®—æ³•**: ç®€å•çš„"å¤šæ•°ç¥¨åˆ¶"æˆ–"åŠ æƒè¯„åˆ†"ï¼Œå¹¶ç”±ä¸€ä¸ª"ä¸»æ¨¡å‹"ç”Ÿæˆæœ€ç»ˆç»¼è¿°ã€‚
  - å­˜å‚¨ç»“æœæ—¶ï¼Œå°†å„æ¨¡å‹çš„å®Œæ•´ JSON å­˜å…¥ `analysis_history.model_details`ã€‚

#### 3. å‰ç«¯äº¤äº’ (`apps/dsa-web`)
- **è®¾ç½®é¡µé¢**:
  - å…è®¸åˆ‡æ¢ `CONFIG_STORAGE_TYPE`ã€‚
  - æ”¯æŒé…ç½®å¤šç»„æ¨¡å‹ API Key (Gemini, DeepSeek, OpenAI)ã€‚
- **åˆ†æé¡µé¢**:
  - å¢åŠ æ¨¡å‹é€‰æ‹©å‹¾é€‰æ¡†ã€‚
  - **ç»“æœå±•ç¤º**:
    - **å¯¹æ¯”è¡¨**: çºµå‘æ’åˆ—å„æ¨¡å‹æ ¸å¿ƒæŒ‡æ ‡ï¼ˆè¯„åˆ†ã€å»ºè®®ã€æ­¢æŸ/æ­¢ç›ˆï¼‰ã€‚
    - **æŠ¥å‘Šè¯¦æƒ…**: æä¾› Tab åˆ‡æ¢è§†å›¾ï¼ŒæŸ¥çœ‹å„æ¨¡å‹çš„ Markdown å®Œæ•´åŸæ–‡ã€‚

---

## âœ… éªŒè¯è®¡åˆ’

### è‡ªåŠ¨åŒ–æµ‹è¯•
1.  **é…ç½®åç«¯æµ‹è¯•**: `tests/test_config_backends.py`
    - éªŒè¯ `EnvBackend` è¯»å†™ `.env` æ­£ç¡®ã€‚
    - éªŒè¯ `DbBackend` è¯»å†™æ•°æ®åº“æ­£ç¡®ã€‚
    - éªŒè¯åˆ‡æ¢ `CONFIG_STORAGE_TYPE` åçš„è¡Œä¸ºã€‚
2.  **å¤šæ¨¡å‹å¹¶å‘åˆ†ææµ‹è¯•**: `tests/test_expert_panel.py`
    - æ¨¡æ‹Ÿ 3 ä¸ªæ¨¡å‹è¿”å›ä¸åŒæ„è§ã€‚
    - éªŒè¯æ±‡æ€»é€»è¾‘ï¼ˆConsensusï¼‰ç”Ÿæˆæ­£ç¡®ã€‚

### æ‰‹åŠ¨éªŒè¯
1.  **æœ¬åœ°è¿è¡Œ**:
    - ä¿æŒ `env` æ¨¡å¼ï¼Œé…ç½® 2 ä¸ªæ¨¡å‹å¹¶å‘ã€‚
    - æ‰‹åŠ¨è¿è¡Œä¸€æ¬¡åˆ†æï¼Œæ£€æŸ¥æ•°æ®åº“ `model_details` æ˜¯å¦å¡«å……ã€‚
2.  **WebUI æ£€æŸ¥**:
    - æ‰“å¼€åˆ†æç»“æœé¡µé¢ï¼ŒéªŒè¯å¯¹æ¯”è¡¨æ ¼æ˜¯å¦ç¾è§‚ã€æ˜“è¯»ã€‚
    - éªŒè¯å¤šä»½æŠ¥å‘Šçš„ Tab åˆ‡æ¢æ˜¯å¦æµç•…ã€‚
